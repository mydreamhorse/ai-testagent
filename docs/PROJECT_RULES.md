# 项目规则

本文档记录了项目的所有规则和约定，所有团队成员都应该遵循这些规则。

## 文件组织规则

### 1. 测试文件规则
- **规则**：所有 `test_*.py` 文件都放在 `tests` 目录下
- **框架**：使用 pytest 框架编写
- **目的**：作为回归测试脚本使用
- **示例**：
  ```
  tests/
  ├── test_frontend_auth.py
  ├── test_sqlalchemy_query.py
  ├── test_fastapi_query.py
  └── ...
  ```

### 2. 文档文件规则
- **规则**：所有 `*.md` 文件都直接创建到根目录的 `docs` 目录下，除了 `README.md` 放在根目录下
- **目的**：保持项目根目录整洁，集中管理文档
- **示例**：
  ```
  docs/
  ├── PROJECT_RULES.md
  ├── TESTING_GUIDE.md
  ├── DEPLOYMENT.md
  ├── PRD.md
  └── ...
  
  README.md  # 只有这个文件在根目录
  ```

## 代码规范

### 1. Python 代码规范
- 使用 Python 3.10+
- 遵循 PEP 8 代码风格
- 使用类型注解
- 编写文档字符串

### 2. 前端代码规范
- 使用 Vue 3 + TypeScript
- 使用 Element Plus UI 组件
- 使用 Pinia 进行状态管理
- 使用 Vue Router 进行路由管理

### 3. 数据库规范
- 使用 SQLAlchemy ORM
- 使用 SQLite 作为开发数据库
- 使用 Alembic 进行数据库迁移

## 测试规范

### 1. 测试文件命名
- 测试文件以 `test_` 开头
- 文件名使用下划线分隔
- 文件名应该描述测试内容

### 2. 测试函数命名
- 测试函数以 `test_` 开头
- 使用描述性的函数名
- 使用下划线分隔单词

### 3. 测试分类
使用 pytest 标记对测试进行分类：
- `@pytest.mark.api` - API测试
- `@pytest.mark.database` - 数据库测试
- `@pytest.mark.frontend` - 前端测试
- `@pytest.mark.integration` - 集成测试
- `@pytest.mark.unit` - 单元测试
- `@pytest.mark.slow` - 慢速测试

### 4. 测试最佳实践
- 每个测试应该独立运行
- 使用 fixtures 共享测试数据
- 提供清晰的断言消息
- 确保测试覆盖关键功能

## 文档规范

### 1. 文档命名
- 使用大写字母和下划线
- 文件名应该描述文档内容
- 使用 `.md` 扩展名

### 2. 文档结构
- 使用清晰的标题层次
- 包含目录（如果文档较长）
- 使用代码块和示例
- 提供相关链接

### 3. 必需文档
- `README.md` - 项目概述和快速开始
- `docs/PROJECT_RULES.md` - 项目规则（本文件）
- `docs/TESTING_GUIDE.md` - 测试指南
- `docs/DEPLOYMENT.md` - 部署指南
- `docs/PRD.md` - 产品需求文档

## 提交规范

### 1. 提交消息格式
```
<type>(<scope>): <subject>

<body>

<footer>
```

### 2. 提交类型
- `feat` - 新功能
- `fix` - 修复bug
- `docs` - 文档更新
- `style` - 代码格式调整
- `refactor` - 代码重构
- `test` - 测试相关
- `chore` - 构建过程或辅助工具的变动

### 3. 提交范围
- `api` - API相关
- `frontend` - 前端相关
- `backend` - 后端相关
- `database` - 数据库相关
- `test` - 测试相关
- `docs` - 文档相关

## 分支规范

### 1. 分支命名
- `main` - 主分支
- `develop` - 开发分支
- `feature/xxx` - 功能分支
- `bugfix/xxx` - 修复分支
- `hotfix/xxx` - 热修复分支

### 2. 分支管理
- 从 `develop` 分支创建功能分支
- 功能完成后合并回 `develop` 分支
- 发布时从 `develop` 分支合并到 `main` 分支

## 环境规范

### 1. 开发环境
- Python 3.10+
- Node.js 16+
- SQLite 3.x
- 使用虚拟环境

### 2. 依赖管理
- Python 依赖：`requirements.txt`
- Node.js 依赖：`package.json`
- 锁定文件：`package-lock.json`

### 3. 环境变量
- 使用 `.env` 文件管理环境变量
- 不要提交敏感信息到版本控制
- 提供 `.env.example` 作为模板

## 安全规范

### 1. 认证和授权
- 使用 JWT 进行身份认证
- 实现基于角色的访问控制
- 保护敏感 API 端点

### 2. 数据安全
- 加密敏感数据
- 使用参数化查询防止 SQL 注入
- 验证和清理用户输入

### 3. 配置安全
- 不要在代码中硬编码敏感信息
- 使用环境变量管理配置
- 定期更新依赖包

## 性能规范

### 1. 数据库性能
- 使用索引优化查询
- 避免 N+1 查询问题
- 使用分页处理大量数据

### 2. API 性能
- 实现缓存机制
- 使用异步处理
- 优化响应时间

### 3. 前端性能
- 代码分割和懒加载
- 优化资源加载
- 使用 CDN 加速

## 监控和日志

### 1. 日志规范
- 使用结构化日志
- 记录关键操作和错误
- 设置适当的日志级别

### 2. 监控指标
- API 响应时间
- 错误率
- 系统资源使用情况

## 版本管理

### 1. 版本号格式
使用语义化版本号：`MAJOR.MINOR.PATCH`
- `MAJOR` - 不兼容的 API 修改
- `MINOR` - 向下兼容的功能性新增
- `PATCH` - 向下兼容的问题修正

### 2. 发布流程
1. 更新版本号
2. 更新 CHANGELOG
3. 创建发布标签
4. 部署到生产环境

## 维护和更新

### 1. 定期维护
- 更新依赖包
- 检查安全漏洞
- 清理无用代码

### 2. 规则更新
- 定期审查和更新项目规则
- 收集团队反馈
- 记录规则变更历史

---

**注意**：这些规则是为了保持项目的一致性和可维护性。如果有特殊情况需要违反规则，请先与团队讨论并获得批准。 